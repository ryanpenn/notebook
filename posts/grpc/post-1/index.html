<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.145.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>【gRPC系列一】开发环境 &#183; Notebook</title>
<meta name=description content><link type=text/css rel=stylesheet href=https://ryanpenn.github.io/notebook/css/print.css media=print><link type=text/css rel=stylesheet href=https://ryanpenn.github.io/notebook/css/poole.css><link type=text/css rel=stylesheet href=https://ryanpenn.github.io/notebook/css/syntax.css><link type=text/css rel=stylesheet href=https://ryanpenn.github.io/notebook/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-0d><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://ryanpenn.github.io/notebook/><h1>Notebook</h1></a><p class=lead>My notes on development and other things.</p></div><nav><ul class=sidebar-nav><li><a href=https://ryanpenn.github.io/notebook/>Home</a></li><li><a href=/notebook/posts/>Posts</a></li><li><a href=/notebook/tags/>Tags</a></li><li><a href=https://github.com/ryanpenn/>Github</a></li></ul></nav><p>&copy; 2025. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>【gRPC系列一】开发环境</h1><time datetime=2025-03-05T20:29:10+0800 class=post-date>Wed, Mar 5, 2025</time><h2 id=安装-protobuf>安装 <code>protobuf</code></h2><ul><li>下载 <a href=https://github.com/protocolbuffers/protobuf/releases/tag/v3.20.3>protobuf-v3.20.3</a></li><li>解压到指定目录</li><li>配置环境变量 <code>export PATH=$PATH:/path/to/protobuf/bin</code></li><li>检查是否安装成功 <code>protoc --version</code>，输出版本号则安装成功</li></ul><h2 id=安装-protoc-gen-go-和-protoc-gen-go-grpc>安装 <code>protoc-gen-go</code> 和 <code>protoc-gen-go-grpc</code></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
</span></span><span style=display:flex><span>protoc-gen-go --version
</span></span><span style=display:flex><span><span style=color:#75715e># v1.36.5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
</span></span><span style=display:flex><span>protoc-gen-go-grpc --version
</span></span><span style=display:flex><span><span style=color:#75715e># v1.5.1</span>
</span></span></code></pre></div><h2 id=创建go项目>创建Go项目</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir grpc-example
</span></span><span style=display:flex><span>cd grpc-example
</span></span><span style=display:flex><span>go mod init example.com/grpc-example
</span></span></code></pre></div><h2 id=安装依赖包>安装依赖包</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go get -u google.golang.org/grpc
</span></span><span style=display:flex><span>go get -u google.golang.org/protobuf
</span></span></code></pre></div><h2 id=创建proto文件>创建proto文件</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir proto
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#f92672>package</span> service;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>option</span> go_package <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;./proto&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>service</span> Service {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>rpc</span> HandleRequest (Request) <span style=color:#66d9ef>returns</span> (Response);<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>rpc</span> HandleServerStream (Request) <span style=color:#66d9ef>returns</span> (stream Response);<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>rpc</span> HandleClientStream (stream Request) <span style=color:#66d9ef>returns</span> (Response);<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>rpc</span> HandleBiStream (stream Request) <span style=color:#66d9ef>returns</span> (stream Response);<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>Request</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>string</span> type <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>bytes</span> payload <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>Response</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>bytes</span> payload <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=生成go代码>生成Go代码</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>protoc --go_out<span style=color:#f92672>=</span>. --go_opt<span style=color:#f92672>=</span>paths<span style=color:#f92672>=</span>source_relative --go-grpc_out<span style=color:#f92672>=</span>. --go-grpc_opt<span style=color:#f92672>=</span>paths<span style=color:#f92672>=</span>source_relative proto/service.proto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 此时 proto 目录中将创建两个文件 service.pb.go 和 service_grpc.pb.go</span>
</span></span></code></pre></div><h2 id=完善项目代码>完善项目代码</h2><p>最终项目结构如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── README.md
</span></span><span style=display:flex><span>├── cmd
</span></span><span style=display:flex><span>│   ├── client
</span></span><span style=display:flex><span>│   │   └── main.go
</span></span><span style=display:flex><span>│   └── server
</span></span><span style=display:flex><span>│       └── main.go
</span></span><span style=display:flex><span>├── go.mod
</span></span><span style=display:flex><span>├── go.sum
</span></span><span style=display:flex><span>├── internal
</span></span><span style=display:flex><span>│   ├── client.go
</span></span><span style=display:flex><span>│   ├── server.go
</span></span><span style=display:flex><span>│   └── service.go
</span></span><span style=display:flex><span>└── proto
</span></span><span style=display:flex><span>    ├── service.pb.go
</span></span><span style=display:flex><span>    ├── service.proto
</span></span><span style=display:flex><span>    └── service_grpc.pb.go
</span></span></code></pre></div></div></main></body></html>